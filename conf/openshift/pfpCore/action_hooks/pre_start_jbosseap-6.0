#!/bin/bash

echo "** inside pre_start_jbosseap-6.0 "

# now increasing PermGen and lowering heap
export JAVA_OPTS="-client -Xmx664m -XX:MaxPermSize=256m -XX:+AggressiveOpts -Dorg.jboss.resolver.warning=true -Djava.net.preferIPv4Stack=true -Dfile.encoding=UTF-8 -Djava.net.preferIPv4Stack=true -Djboss.node.name=${OPENSHIFT_GEAR_DNS} -Djgroups.bind_addr=${OPENSHIFT_INTERNAL_IP}"
export JBOSS_MODULEPATH_ADD=$JBOSS_MODULEPATH:$HOME/${openshift.jboss.cartridge.type}/tmp/pfpModules

cleanRuntime() {
    if [ -e $HOME/${openshift.jboss.cartridge.type}/${openshift.jboss.cartridge.type}/standalone/log/server.log ]
    then
        echo -en "cleanRuntime() \n";
        rm $HOME/${openshift.jboss.cartridge.type}/${openshift.jboss.cartridge.type}/standalone/log/server.log
    fi

}

createSoftLinksToWebArchives() {
    cd $OPENSHIFT_REPO_DIR/deployments
    echo -en "createSoftLinksToWebArchives() will now create soft links \n";

    if [ -e ${console.server.name} ]
    then
        rm ${console.server.name}
    fi
    ln -s ~/${openshift.jboss.cartridge.type}/tmp/deployments/${console.server.name}
    touch ${console.server.name}.dodeploy


    if [ -e ${console.name} ]
    then
        rm ${console.name}
    fi
    ln -s ~/${openshift.jboss.cartridge.type}/tmp/deployments/${console.name}
    touch ${console.name}.dodeploy

    if [ -e ${designer.name} ]
    then
        rm ${designer.name}
    fi
    ln -s ~/${openshift.jboss.cartridge.type}/tmp/deployments/${designer.name}
    touch ${designer.name}.dodeploy

    if [ -e ${guvnor.name} ]
    then
        rm ${guvnor.name}
    fi
    ln -s ~/${openshift.jboss.cartridge.type}/tmp/deployments/${guvnor.name}
    touch ${guvnor.name}.dodeploy
}

cleanRuntime
createSoftLinksToWebArchives
